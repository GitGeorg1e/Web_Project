<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Πίνακας Διδάσκοντα — Thesis System</title>

  <link rel="stylesheet" href="/styles.css" />

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- FilePond (PDF uploader) -->
  <link rel="stylesheet" href="https://unpkg.com/filepond/dist/filepond.min.css">
  <script src="https://unpkg.com/filepond/dist/filepond.min.js"></script>
  <script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.min.js"></script>
  <script src="https://unpkg.com/filepond-plugin-file-validate-size/dist/filepond-plugin-file-validate-size.min.js"></script>

  <!-- μικρό CSS για tabs (ελάχιστες αλλαγές) -->
  <style>
    .tab{display:none}
    .tab.active{display:block}
    nav.card a.active{font-weight:600;text-decoration:underline}
  </style>
</head>
<body>

  <!-- Topbar -->
  <header class="topbar">
    <div class="title">Διαχείριση Διπλωματικών</div>
    <div style="display:flex;align-items:center;gap:12px">
      <span id="welcome" class="muted">—</span>
      <button id="logoutBtn" class="secondary small">Αποσύνδεση</button>
    </div>
  </header>

  <main class="container">

    <!-- Sub-nav -->
    <nav class="card" aria-label="Πλοήγηση">
      <div class="actions" style="display:flex;gap:18px;flex-wrap:wrap">
        <a href="#topics">Θέματα</a>
        <a href="#assign">Ανάθεση</a>
        <a href="#my-topics">Τα θέματα μου</a>
        <a href="#assignments">Αναθέσεις</a>
        <a href="#theses">Οι διπλωματικές μου</a>
        <a href="#manage-assignment">Διαχείριση ΔΕ</a>
        <a href="#invitations">Προσκλήσεις</a>
        <a href="#stats">Στατιστικά</a>
      </div>
    </nav>

    <!-- Δημιουργία / Επεξεργασία Θέματος -->
    <section id="topics" class="card tab active" aria-labelledby="topics-title">
      <h2 id="topics-title">Θέμα διπλωματικής (Δημιουργία / Επεξεργασία)</h2>

      <div class="grid" style="margin-top:8px">
        <div>
          <label for="t_title">Τίτλος</label>
          <input id="t_title" type="text" placeholder="Π.χ. Distributed Systems Thesis" />
        </div>

        <div>
          <label for="t_pdf">Αρχείο PDF (προαιρετικό)</label>
          <input id="t_pdf" type="file" accept="application/pdf" />
        </div>

        <div style="grid-column:1 / -1">
          <label for="t_desc">Σύνοψη</label>
          <textarea id="t_desc" placeholder="Σύντομη περιγραφή του θέματος..."></textarea>
        </div>

        <div style="display:flex;gap:10px">
          <button id="createTopicBtn" class="btn">Αποθήκευση</button>
          <button id="cancelEditBtn" class="secondary">Ακύρωση επεξεργασίας</button>
        </div>
      </div>

      <small id="topicFormHint" class="muted" style="display:block;margin-top:10px">
        Λειτουργία: Δημιουργία
      </small>
    </section>

    <!-- Ανάθεση θέματος -->
    <section id="assign" class="card tab" aria-labelledby="assign-title">
      <h2 id="assign-title">Ανάθεση Θέματος</h2>

      <div class="grid" style="margin-top:8px">
        <div>
          <label for="a_topic">ID Θέματος</label>
          <input id="a_topic" type="number" placeholder="π.χ. 5" />
        </div>
        <div>
          <label for="a_student">ID Φοιτητή</label>
          <input id="a_student" type="number" placeholder="π.χ. 12" />
        </div>
        <div style="display:flex;gap:10px">
          <button id="assignBtn" class="btn">Ανάθεση</button>
        </div>
      </div>

      <!-- Ακύρωση ανάθεσης -->
      <div class="spacer"></div>
      <div class="grid">
        <div>
          <label for="cancel-assignment-id">assignment_id</label>
          <input id="cancel-assignment-id" placeholder="π.χ. 23" />
        </div>
        <div>
          <label for="cancel-reason">Reason (optional)</label>
          <input id="cancel-reason" placeholder="Προαιρετικά, αιτιολογία" />
        </div>
        <div style="display:flex;align-items:end;gap:10px">
          <button id="btn-cancel-assignment" type="button" class="secondary">Ακύρωση ανάθεσης</button>
          <p id="cancel-msg" class="muted" style="margin:0"></p>
        </div>
      </div>
    </section>

    <!-- Λίστα Θεμάτων -->
    <section id="my-topics" class="card tab" aria-labelledby="my-topics-title">
      <h2 id="my-topics-title">Τα θέματα μου</h2>
      <div class="spacer"></div>
      <div style="overflow:auto">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Τίτλος</th>
              <th>PDF</th>
              <th>Δημιουργήθηκε</th>
              <th class="text-right">Ενέργειες</th>
            </tr>
          </thead>
          <tbody id="topicsTbody"></tbody>
        </table>
      </div>
    </section>

    <!-- Αναθέσεις -->
<section id="assignments" class="card tab" aria-labelledby="assignments-title">
  <h2 id="assignments-title">Αναθέσεις</h2>
  <div class="spacer"></div>
  <div style="overflow:auto">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Φοιτητής</th>
          <th>Θέμα</th>
          <th>Επιβλέπων</th> <!-- ΝΕΑ ΣΤΗΛΗ -->
          <th>Κατάσταση</th>
          <th class="text-right">Ενέργειες</th>
        </tr>
      </thead>
      <tbody id="assignmentsTbody"></tbody>
    </table>
  </div>
  <div class="actions" style="margin-top:10px">
    <a id="exportJson" href="#">Export JSON</a> •
    <a id="exportCsv" href="#">Export CSV</a>
  </div>
</section>


    <!-- Οι διπλωματικές μου -->
    <section id="theses" class="card tab" aria-labelledby="theses-title">
      <h2 id="theses-title">Οι διπλωματικές μου</h2>

      <div class="row" style="gap:8px;align-items:flex-end">
        <div>
          <label for="flt-role">Ρόλος</label>
          <select id="flt-role">
            <option value="">— Όλοι —</option>
            <option value="supervisor">Επιβλέπων</option>
            <option value="committee">Τριμελής</option>
          </select>
        </div>

        <div>
          <label for="flt-status">Κατάσταση</label>
          <select id="flt-status">
            <option value="">— Όλες —</option>
            <option value="under_assignment">Υπό ανάθεση</option>
            <option value="active">Ενεργή</option>
            <option value="under_review">Υπό εξέταση</option>
            <option value="completed">Περατωμένη</option>
            <option value="canceled">Ακυρωμένη</option>
          </select>
        </div>

        <div>
          <label for="flt-pagesize">Ανά σελίδα</label>
          <select id="flt-pagesize">
            <option>10</option>
            <option selected>20</option>
            <option>50</option>
          </select>
        </div>

        <button id="btn-apply" type="button" class="btn">Εφαρμογή</button>
      </div>

      <div id="theses-result" style="margin-top:12px">
        <div class="row" style="justify-content:space-between;margin:8px 0">
          <div id="pager-info"></div>
          <div>
            <button id="btn-prev" type="button" class="secondary small">◀ Προηγούμενη</button>
            <button id="btn-next" type="button" class="secondary small">Επόμενη ▶</button>
          </div>
        </div>

        <div style="overflow:auto">
          <table id="theses-table" class="table">
            <thead>
              <tr>
                <th>#</th>
                <th>Ρόλος</th>
                <th>Κατάσταση</th>
                <th>Τίτλος</th>
                <th>Φοιτητής</th>
                <th>Ανάθεση</th>
                <th>Επιτροπή (αν ισχύει)</th>
              </tr>
            </thead>
            <tbody id="theses-body">
              <tr><td colspan="7">Φόρτωση…</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ΔΙΑΧΕΙΡΙΣΗ ΔΕ -->
    <section class="card tab" id="manage-assignment" aria-labelledby="manage-title">
      <h2 id="manage-title">Διαχείριση Διπλωματικής</h2>

      <div class="row" style="gap:8px;align-items:flex-end">
        <label>Assignment ID
          <input id="m-assignment-id" placeholder="π.χ. 12">
        </label>
        <button id="m-load-invitations" type="button">Προσκλήσεις (Υπό Ανάθεση)</button>
        <button id="m-cancel-under" type="button">Ακύρωση (Υπό Ανάθεση)</button>
      </div>

      <details style="margin-top:10px">
        <summary><strong>Ακύρωση (Ενεργή) — από επιβλέποντα</strong></summary>
        <div class="row" style="gap:8px;align-items:flex-end;margin-top:8px">
          <input id="m-council-number" type="number" placeholder="Αριθμός Γ.Σ.">
          <input id="m-council-year" type="number" placeholder="Έτος Γ.Σ.">
          <button id="m-cancel-active" type="button">Ακύρωση (με Γ.Σ.)</button>
        </div>
        <small>Απαιτείται να έχουν περάσει 2 έτη από το <code>finalized_at</code>.</small>
      </details>

      <hr style="margin:12px 0">

      <div class="row" style="gap:8px;align-items:flex-end">
        <button id="m-list-notes" type="button">Σημειώσεις (Ενεργή)</button>
        <input id="m-note-text" maxlength="300" placeholder="Νέα σημείωση (έως 300 χαρακτ.)" style="width:300px">
        <button id="m-add-note" type="button">Προσθήκη σημείωσης</button>
        <button id="m-move-under-review" type="button">Μετάπτωση σε Υπό Εξέταση</button>
      </div>

      <hr style="margin:12px 0">

      <div class="row" style="gap:8px;align-items:flex-end">
        <button id="m-get-draft" type="button">Πρόχειρο/Links (Υπό Εξέταση)</button>
        <button id="m-announcement" type="button">HTML Ανακοίνωσης</button>
      </div>

      <details style="margin-top:10px">
        <summary><strong>Βαθμολόγηση (Υπό Εξέταση)</strong></summary>
        <div class="row" style="gap:8px;align-items:flex-end;margin-top:8px">
          <label>Enable grading
            <select id="m-grading-enabled">
              <option value="1">On</option>
              <option value="0">Off</option>
            </select>
          </label>
          <button id="m-enable-grading" type="button">Αποθήκευση</button>
        </div>
        <div class="row" style="gap:8px;align-items:flex-end;margin-top:8px">
          <input id="m-grade-total" type="number" step="0.1" min="0" max="10" placeholder="Συνολικός βαθμός 0-10">
          <input id="m-grade-criteria" placeholder='Κριτήρια (JSON), π.χ. {"quality":9}'>
          <button id="m-submit-grade" type="button">Καταχώρηση βαθμού</button>
          <button id="m-list-grades" type="button">Προβολή βαθμών</button>
        </div>
      </details>

      <pre id="m-output"></pre>

    </section>

    <!-- Προσκλήσεις Τριμελούς -->
    <section id="invitations" class="card tab" aria-labelledby="inv-title">
      <h2 id="inv-title">Προσκλήσεις Τριμελούς</h2>
      <div class="spacer"></div>
      <div style="overflow:auto">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Θέμα</th>
              <th>Φοιτητής</th>
              <th>Κατάσταση</th>
              <th class="text-right">Ενέργεια</th>
            </tr>
          </thead>
          <tbody id="invTbody"></tbody>
        </table>
      </div>
    </section>

    <!-- Στατιστικά -->
    <section id="stats" class="card tab" aria-labelledby="stats-title">
      <h2 id="stats-title">Στατιστικά</h2>
      <div class="spacer"></div>
      <canvas id="statsChart" width="400" height="160"></canvas>
    </section>

    <div class="toast-wrap" aria-live="polite" aria-atomic="true"></div>
  </main>

  <!-- Υπάρχοντα scripts -->
  <script src="/js/teacher-theses.js" defer></script>
  <script src="/js/teacher.js" defer></script>
  <script src="/js/teacher-manage.js" defer></script>
</body>
</html>
